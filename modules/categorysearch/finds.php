<?php		require_once(dirname(__FILE__).'/../../config/config.inc.php');require_once(dirname(__FILE__).'/../../init.php');require_once(dirname(__FILE__).'/categorysearch.php');$module = new CategorySearch();$context = Context::getContext();$query = Tools::replaceAccentedChars(urldecode(Tools::getValue('q')));$original_query = Tools::getValue('q');$id_category = Tools::getValue('id_category');if($id_category == 'all'){	$searchResults = Search::find((int)(Tools::getValue('id_lang')), $query, 1, (int)Tools::getValue('limit',10), 'position', 'desc', true);						$results = array();			foreach ($searchResults as $product){		$cover = Product::getCover($product['id_product']);						$product['product_link'] = $context->link->getProductLink($product['id_product'], $product['prewrite'], $product['crewrite']);						$product['product_image'] = $context->link->getImageLink($product['prewrite'], $cover['id_image'], 'home_default');						$product['id_category'] = $id_category;		$results[] = $product;							}	}else{		$searchResults = Search::find((int)(Tools::getValue('id_lang')), $query, 1, (int)Tools::getValue('limit',10), 'position', 'desc', true);			$results = array();			foreach ($searchResults as $product){		$allCategories = Product::getProductCategories($product['id_product']);						if (in_array((int)$id_category, $allCategories)){								$cover = Product::getCover($product['id_product']);									$product['product_link'] = $context->link->getProductLink($product['id_product'], $product['prewrite'], $product['crewrite']);									$product['product_image'] = $context->link->getImageLink($product['prewrite'], $cover['id_image'], 'home_default');									$product['id_category'] = $id_category;									$results[] = $product;				}		}}			die(Tools::jsonEncode($results));?>